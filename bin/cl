#!/usr/bin/env zsh
# Claude Code wrapper - works in any shell context

# Interactive mode: no args, or interactive flags (-r/--resume, -c/--continue)
if [[ $# -eq 0 || "$1" == "--resume" || "$1" == "-r" || "$1" == "--continue" || "$1" == "-c" ]]; then
    # Remove stale session ID before starting
    rm -f ~/.claude/.last_session_id
    claude --dangerously-skip-permissions "$@"
    # Print resume command if session ID was saved by hook
    if [[ -f ~/.claude/.last_session_id ]]; then
        echo "\e[2mcl --resume $(cat ~/.claude/.last_session_id)\e[0m"
        rm ~/.claude/.last_session_id
    fi
else
    # Non-interactive: Opus, no session persistence for one-off queries
    # ANTHROPIC_API_KEY="" is intentional - workaround for Claude Code bug where
    # env API key causes issues in query mode. Forces use of stored credentials.
    # --tools default enables all tools (disabled by default in --print mode)
    # --dangerously-skip-permissions required for tools to actually execute in --print mode
    ANTHROPIC_API_KEY="" exec claude --print --output-format=text --tools default --dangerously-skip-permissions --no-session-persistence --model opus "$@"
fi
